---
bibliography:
    - reference.bib
csl:
    - chinese-chemical-letters.csl
title: '图像局部去模糊方法'
link-citations: true
lang: en-GB
figPrefix:
    - Fig.
    - Figs.
linkReferences: true
pagesize: a4
'coloring''s': true
links-as-notes: true
---  

#### 图像局部去模糊

* 图像局部去模糊是一种对图像进行清晰化的处理方法，其主要目的是去除图像中的模糊或者增强图像的清晰度。以下是几种常见的图像局部去模糊的处理方法：
    
    + 双边滤波（Bilateral Filtering）：双边滤波是一种非线性滤波方法，能够在保持图像边缘的同时去除噪声。它基于图像中像素之间的相似性和距离，在去除噪声的同时保留了图像的细节信息。   
    
    + 傅里叶变换（FFT）：傅里叶变换是一种将信号从时域变换到频域的方法，可用于对图像进行去模糊处理。该方法能够提取图像中的高频信息，从而恢复模糊的细节。
    
    + 统计学方法：统计学方法可以利用图像的概率分布特性，对模糊进行建模，并对图像进行去模糊处理。该方法适用于对大面积均匀模糊的图像进行处理。

    + 深度学习方法：深度学习方法可以通过训练神经网络来实现图像去模糊处理。该方法通常需要大量的训练数据和计算资源，但可以在更高的精度和效率下处理图像模糊问题。

* 总之，不同的图像局部去模糊处理方法都有其优点和适用范围。在实际应用中，需要根据图像的特点和处理要求来选择最适合的处理方法。

#### 挑战

##### 挑战一

* 图像去模糊技术目前面临的一个重要问题，主要涉及到如何准确建模复杂的模糊场景。以下是一些解决这个挑战的方法：

    + 非线性模型建模：针对复杂模糊场景，可以考虑使用非线性模型来建模成像过程。例如，可以使用自适应非线性滤波方法来处理非均匀模糊问题，或者使用光流方法来处理动态场景下的模糊问题。

    + 深度学习模型：近年来，深度学习模型已经成为图像去模糊领域的研究热点。深度学习模型可以自动从数据中学习复杂的模糊场景，并生成高质量的清晰图像。例如，可以使用基于深度卷积神经网络（CNN）的图像去模糊方法，它们可以利用大量的有标注数据来训练模型，以生成高质量的清晰图像。

    + 图像先验知识：在模糊场景的建模过程中，还可以利用图像的先验知识来帮助改善模糊复原的效果。例如，可以使用稀疏表示方法来利用图像在某些变换域上的稀疏性质，或者使用图像的统计特征来减少噪声影响，以提高图像复原的质量。

* 综上所述，要解决图像去模糊领域的挑战，需要综合运用多种方法，包括非线性模型建模、深度学习模型和图像先验知识等，以提高图像复原的精度和效率。

##### 挑战二

* 当前图像去模糊技术面临的挑战之一，主要涉及到如何获得大量高质量的清晰图像-模糊图像对，以用于模型的训练和优化。为了解决这个问题，研究人员提出了一些方法，如以下所示：

    + 合成数据：使用图像合成技术来生成一些虚拟的清晰图像-模糊图像对，以扩充现有的数据集。这种方法虽然可以解决数据稀缺问题，但是生成的数据可能无法完全覆盖真实场景下的各种模糊情况，从而影响模型的泛化性能。

    + 无监督学习：使用无监督学习方法来训练模型，以避免对清晰图像-模糊图像对的依赖。无监督学习可以从未标注的数据中学习模型，以生成清晰图像或模糊图像。但是，无监督学习方法通常需要更长的训练时间和更复杂的模型设计。

    + 迁移学习：使用迁移学习方法将已经训练好的模型从特定场景迁移到通用场景中。迁移学习可以利用预训练模型的知识来加速新模型的训练，并减少需要的训练数据量。这种方法可以提高模型在通用场景中的泛化性能，但需要大量数据和计算资源来完成训练。

* 综上所述，图像去模糊领域面临的挑战包括如何获取大量高质量的清晰图像-模糊图像对和如何提高模型的泛化能力。为了解决这些挑战，研究人员正在探索一些方法，如使用合成数据、无监督学习和迁移学习等。

##### 挑战三

* 图像局部去模糊的处理方法中，相关的算法复杂度一般都较高，不适合端侧轻量化部署。

    + 当前一些高效的图像去模糊算法，如基于非局部均值（Non-local Means, NL-means）和双边滤波（Bilateral Filtering）等算法，虽然在图像复原效果方面有不错的表现，但是它们的计算复杂度相对较高，不太适合于端侧轻量化部署。
    
    + 因此，一些研究者提出了  一些轻量化的图像去模糊算法，如基于快速傅里叶变换（FFT）的方法、基于快速加权迭代算法（Fast Weighted Iterative Algorithm, FWIA）的方法等，这些方法虽然在一定程度上降低了算法复杂度，但是图像复原效果可能有所折损。因此，在实际应用中需要根据具体情况选择合适的算法。

#### 图像局部去模糊的发展历程

* 图像去模糊是一项重要的图像处理任务，其目的是去除图像中由于相机晃动或者物体运动等原因造成的模糊。随着计算机技术的发展，图像去模糊方法也在不断地进步和发展。这些技术都有一个共同的目标，即从一盲个或几个相应的模糊图像中推断出一个潜在的锐利图像，而去模糊技术也需要得到一个准确的模糊核。去模糊技术发展的分类如下图法figure 1。

    <div align=center><img src="picture/去模糊算法分类.png" alt="No Picture" style="zoom:70%"/><center><p>Figure 1 去模糊算法分类</p></right></div>

##### 按方法分类

* 传统方法：从20世纪60年代开始，去模糊方法是基于频域滤波的方法，比如退化函数的逆滤波 @yamada_image_2006 和维纳滤波等。这些方法虽然可以较好地还原一些简单的模糊情况，但在复杂的模糊场景下效果不佳，因为基于频域的图像去模糊算法需要准确的知道模糊的退化类型 @li_survey_2022 。因此提出了一些基于空间域的图像去模糊从估计算法，常见的基于空间域的估计算法有：差分恢复算法、最小二乘法、最大熵算法等等。
    + 早期研究的一些方法大多基于跟随模糊模型(Following blur model)，如figure 2所示：$$\mathbf{B} = \mathbf{K}\mathbf{S} + \mathbf{n}$$
    
    + $\mathbf{B}$为向量化模糊图像；
 
    + $\mathbf{S}$为潜在锐像；

    + $\mathbf{n}$为噪声。 
    
    + $\mathbf{K}$是模糊核，它是一个大的稀疏矩阵，它的每一行都包含一个局部模型核，作用于S一生成一个模糊像素。同样，这里可以理解为*退化函数*，通常来说模糊图像可以概括为锐化图像，经过退化函数作用后，再附加上随机噪声，最后输出为模糊图像。常见的退化类型有运动模糊、高斯模糊、离焦模糊、湍流模糊等。

  + 根据模糊核在是否已知可以分为非盲去模糊（已知$\mathbf{B}$估计$\mathbf{K}$和$\mathbf{S}$）和盲去模糊（已知$\mathbf{B}$和$\mathbf{K}$估计$\mathbf{S}$），如figure 3和figure 4所示。在实践中，模糊核$\mathbf{K}$是未知的。

    + <div align=center><img src="picture/早期图像去模糊问题.png" alt="No Picture" style="zoom:70%"/><center><p>Figure 2 Following blur model</p></right></div>

    + <div align=center><img src="picture/非盲去模糊.png" alt="No Picture" style="zoom:40%"/><center><p>Figure 3 Non-blind</p></right></div>
    
    + <div align=center><img src="picture/盲去模糊.png" alt="No Picture" style="zoom:70%"/><center><p>Figure 4 Blind</p></right></div>

    + 早期经典方法的缺陷是无法利用自然图像的先验信息，因此恢复后的图像精度不高，主要用于非盲图像的去模糊。

* 基于偏微分方程（PDE）的方法：PDE是一类可以描述动态系统的数学方程，可以用来描述图像的动态变化。基于PDE的图像去模糊方法可以克服一些传统方法的局限性，但其计算量很大，不适合处理大规模图像。

* 基于统计学习的方法：随着机器学习的发展，越来越多的研究者开始将机器学习方法应用于图像去模糊任务中。其中，基于稀疏表示和低秩约束的方法成为研究热点，比如基于K-SVD的方法和基于非负矩阵分解的方法等。这些方法不仅可以有效地去除图像中的模糊，还可以处理复杂的图像情况。
    + **基于最大后验概率的图像去模糊算法**的核心思想是找到某个解（清晰图像），使得其后验概率值最大。即为在已知退化图像$y$的条件下，找到一组清晰图像$x$和模糊核$k$，使得概率$P\left( y|x,k \right)$最大，其数学表示为$$\hat{x}, \hat{k} = \arg \min_{x,k} P(y|x, k)$$根据贝叶斯公式，可将上式转化为$$\hat{x}, \hat{k} = \arg \min_{x,k}P(x,k|y) \ P(x) \ P(k)$$其中，$P(x,k|y)$为似然概率，其概率分布即为噪声$n$的分布。$P(x)$和$P(k)$分别为清晰图像$x$和模糊核$k$的先验概率。
    根据$MAP$框架建模的方式不同，去模糊算法可以分为两类：基于稀疏先验的图像去模糊算法，修改数据项的图像去模糊算法。
    + **基于稀疏先验的图像去模糊算法**：基于MAP的先验算法是通过修改MAP框架的先验项来克服图像去模糊的病态问题，从而复原出清晰图像。在通常情况下，该类方法建立在线性退化模型的基础上，假设噪声服从高斯分布，并且其均值为$0$方差为$\sigma$。而图像的先验概率和模糊核的先验概率分别为$P(x) \varpropto e^{-\rho(x)}, P(k) \varpropto e^{- \rho(k)}$则可以得到基于最大后验概率的图像去模糊框架为$$\hat{x},\hat{k}=\arg\min_{x,k} {\Vert k \otimes x - y \Vert}^2_2  + \lambda_1 \rho(k)+\lambda_2 \rho(x)$$其中，$\lambda_1 \rho(k)+\lambda_2 \rho(x)$分别为图像的先验概率。特别地，这里的框架是一种盲目反卷积框架，对于非盲目反卷积同样具有类似的框架，$$\hat{x}=\arg\min_{x,k} {\Vert k \otimes x - y \Vert}^2_2  + \lambda_1 \rho(k)$$该类方法就是要通过设计$\rho(k)$和$\rho(x)$，实现约束病态问题具有可逆的过程并最终收敛至清晰图像。

    + **基于变分贝叶斯框架的去模糊算法**：基于变分贝叶斯的图像去模糊算法的核心思想是考虑所有可能的解，所以理论上是更稳健的。Fergus使用混合高斯模型通过贝叶斯推断学习一个梯度先验，Levin提出这种基于贝叶斯推断的方法可以避免MAP问题中出现的趋向于平凡解的问题。但由于需要遍历整个解空间，算法的速度太慢，无法达到实用的要求。

    + **基于边缘估计的去模糊算法**：基于边缘估计的盲目反卷积算法的核心思想是通过一些滤波、图像增强等算法显式地估计出具有大尺度边缘、细小边缘被抑制的图像，然后基于这些显著边缘来估计模糊核。基于边缘估计的去模糊算法速度快并且已经证明在实际应用中非常有效，但是很难去分析，因为并不是基于模型通过优化得到，而是通过一些启发式的步骤的组合得到。
      + 基于边缘估计的盲目反卷积算法能够成功估计出模糊核的原因是其能够估计出图像中的大尺度边缘，抑制细小的边缘。文献中指出大尺度边缘更利于真实模糊核的估计，而细小的边缘起着相反的作用。文中采用双边滤波器提取图像的大尺度边缘，将提取的边缘图像用于模糊核估计。算法流程如图figure 5所示.
        <div align=center><img src="picture/去模糊过程.png" alt="No Picture" style="zoom:70%"/><center><p>Figure 5 去模糊过程</p></right></div>

* 基于深度学习的方法：近年来，深度学习技术的快速发展，使得其在图像去模糊任务中也得到了广泛的应用。其中，基于卷积神经网络（CNN）的方法已成为主流，比如`SRCNN`、`VDSR`、`ResNet`等。这些方法不仅具有较高的去模糊效果，而且可以大大提高计算速度，适合实时应用。
  
  + **基于深度卷积神经网络的图像去模糊方法**`(Deep Convolutional Neural Network，DCNN)`
    
    + 在非盲环境下对模糊图像进行去模糊，通过建立一个基于可分离核属性的网络，即(逆)模糊核可以分解成少量的有效滤波器。此外，还可以加入去噪网络 @eigen_restoring_2013 ，通过将模块连接到网络的末端来减少噪声和颜色饱和度等视觉伪影 @xu_deep_2014 。
        
      + 去噪网络是一类用于降低图像噪声的深度学习模型，它们的主要目标是从带噪声的图像中恢复出原始图像，使其更加清晰和可识别。去噪网络一般可以分为*基于降噪自编码器*和*基于卷积神经网络*两种类型。
    
      + **伪逆内核**：假设线性模糊模型为：$y=x \otimes k$；空间卷积可以转化为频域乘法：$\mathcal{F(y)}=\mathcal{F(x)} \cdot \mathcal{F(k)}$. 其中$F(\cdot)$表示离散傅里叶变换`(DFT)`，操作符$\cdot$是元素相乘。在傅里叶域中，$x$可以表示为：$$x=\mathcal{F}^{-1}(\frac{\mathcal{F}(y)} {\mathcal{F}(k)}=\mathcal{F}^{-1}(\frac{1}{\mathcal{F}(k)}) \otimes y$$其中，$\mathcal{F}^{-1}$为逆离散傅里叶变换。$x$的解写成一种空间卷积，核为$\mathcal{F}^{-1}(\frac{1}{\mathcal{F}(k)})$，内核实际上是一个在没有紧支柱的情况下跨越整个空间域的重复信号。当噪声出现时，通常使用正则化项来避免频域中除数为零，使得伪逆在空间域中快速衰减。
      经典的维纳反卷积相当于使用`Tikhonov`正则化矩阵。维纳反卷积如下：$$x=\mathcal{F}^{-1}(\frac{1}{\mathcal{F}(k)} {\frac{|\mathcal{F}(k)|^{2}}{\mathcal{F}(k)|^{2}+\frac{1}{SNR}}}) \otimes y=k^{\mathcal{T}} \otimes y$$ $SNR$为信噪比，$k^\mathcal{T}$为伪逆核$k^\mathcal{T}$且$SNR=1E-4$

      + $SNR$为信噪比，$k^\mathcal{T}$为伪逆核，噪声越大，$\frac{1}{SNR}$就越大。下图(a)显示了一个半径为7的磁盘模糊核，通常用于焦模糊模型。下图(b)是伪逆核$k^\mathcal{T}$且$SNR=1E-4$，一张使用此模糊核的图像如图(c)，$k^\mathcal{T}$结合反卷积的结果如图(d)。这种方法可以去掉一部分图像中的模糊，但是噪声和饱和会引起视觉伪影，这与我们对维纳反卷积的理解是一致的。总结来说，使用深度卷积网络来做图像反卷积其实并不简单，增加卷积核来简单地修改网络结构会导致训练难度增加，我们采用一种新的结构来改进网络，结果如图(e)。<div align=center><img src="picture/Pseudo inverse kernel and dedconvolution examples.png" alt="No Picture" style="zoom:70%"/><center><p>Figure 6 Pseudo inverse kernel and dedconvolution examples</p></right></div>

      + 可分离卷积核性的网络结构，即使用可分离卷积核来表示卷积核，及将一个二维卷积核分解为两个一维卷积核的乘积的形式，或者是把二维卷积看成是一维滤波器的加权和，即$h(x,y)=f(x)g(y)$，这种分解方法可以使卷积操作的计算量大大降低，同时也能减少参数数量。然后使用逐通道卷积`(Pointwise Convolution)`对通道之间的信息进行交互，以达到与标准卷积类似的效果，但参数数量和计算复杂度都大大降低。
      
      + 核可分性是通过奇异值分解（SVD）来实现的，给定伪逆核$k^{\mathcal{T}}$，可以分解为$k^{\mathcal{T}}=USV \ \ T$，用$u_j$、$u_j$分别表示$U$和$V$的第$j$列，$s_j$为第$j$个奇异值，原始的伪反卷积可以表示为：$$k^{\mathcal{T}}*y=\sum_j s_j \cdot u_j * (v_j^{T}*y)$$
      
    + 

* 总之，图像去模糊方法的发展经历了从经典方法到基于`PDE`的方法，再到基于统计学习和深度学习的方法的演进过程，未来还会继续探索更加高效、准确的图像去模糊方法。

##### 按照模糊核分类

* **非盲去模糊**`(Non-Blind Deblurring)`
    + 如果有了模糊核$\mathbf{K}$，被称为非盲目去模糊，即使有了模糊核，由于传感器的噪声和高频信息的损失，这个任务也具有挑战性。一些非深度方法采用自然图像先验，例如全局或局部先验，或在空间域或在频率域。为了克服不希望出现的环形伪影，空间去卷积和深度神经网络被结合起来。有方法处理饱和区域，去除由图像噪声引起的不需要的伪影。
    
    + 下表中总结了现有的基于非盲的深度学习方法。这些方法可以大致分为两组:第一组使用反卷积，然后去噪，而第二组直接使用深度网络。<div align=center><img src="picture/非盲去模糊方法概述.jpg" alt="No Picture" style="zoom:70%"/><center><p>Table 1 Overview of deep single image non-blind deblurring methods</p></right></div>
      + **去噪反卷积**`Deconvolution with Denoising`：
      + **反卷积的学习先验**`Learning priors for deconvolution`

* **盲去模糊**`Blind Deblurring`

#### 评估方式

* **完全参考指标**`(Full-Reference Metrics)`通过比较修复后的图像和地面实况`(GT)`来评估图像质量，例如`PSNR`@hore2010image 、`SSIM`@wang2004image、`WSNR`、`MS-SSIM`、`IFC`、`NQM`、`UIQI`、`VIF`和`LPIPS`。其中`RSNR`和`SSIM`是图像修复任务中最常使用的指标。此外，LPIPS和E-LPIPS能准确预测人类对图像质量的判断。

* **非参考指标**`(No-Reference Metrics)`只使用去模糊的图像来衡量质量，例如`BIQI`、`BLINDS2`、`BRISQUE`、`CORNIA`、`DIIVINE`、`NIQE`和`SSEQ`。此外，通过比较对不同视觉任务(如物体检测和识别)准确性的影响，已经开发了一些指标来评估图像去模糊算法的性能

#### 数据集

BSDS500 @xu_deep_2014

T91 @xu_deep_2014

#### Reference